<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Bloxd Autoclicker Detector — Rejo Edition (Final)</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React / ReactDOM / Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      body {
        background: #000;
        color: #fff;
        font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      }
      .card {
        background: #050505;
        border: 1px solid #141414;
      }
      .sparkline-canvas {
        width: 100%;
        height: 80px;
        background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
        border-radius: 8px;
        border: 1px solid rgba(255,255,255,0.04);
      }
      .countdown-overlay {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(0,0,0,0.75);
        z-index: 50;
        font-size: 5rem;
        font-weight: bold;
        color: #fff;
        text-shadow: 0 0 20px #6366f1;
      }
    </style>
  </head>

  <body>
    <div id="root"></div>

    <!-- React App -->
    <script type="text/babel" data-presets="react">
      const { useState, useEffect, useRef } = React;

      /* -------------------------
         CodePen Microtime Function
      --------------------------*/
      function microtime() {
        return Date.now() / 1000; // seconds with decimals
      }

      /* Final analyzer (unchanged except intervals are in ms) */
      function analyzeClicks(timestamps) {
        if (timestamps.length < 2)
          return { cps: 0, intervals: [], verdict: "insufficient", reasons: ["Not enough clicks"], doubleClicks: 0 };

        const intervals = [];
        for (let i = 1; i < timestamps.length; i++) {
          intervals.push((timestamps[i] - timestamps[i - 1]) * 1000); // convert sec→ms
        }

        const duration = (timestamps.at(-1) - timestamps[0]);
        const cps = (timestamps.length - 1) / duration;

        const avg = intervals.reduce((a,b)=>a+b,0)/intervals.length;
        const variance = intervals.reduce((a,b)=>a+Math.pow(b-avg,2),0)/intervals.length;
        const std = Math.sqrt(variance);
        const consistency = avg>0?(1-std/avg)*100:0;

        // double click threshold = 80 ms
        const doubleClicks = intervals.filter(i => i <= 80).length;
        const bursts = intervals.filter(i => i <= 70).length;

        const reasons=[];

        if (consistency>70) reasons.push("Very consistent intervals");
        if (doubleClicks>3) reasons.push("Multiple double clicks detected");
        if (bursts>6) reasons.push("Rapid bursts detected");

        let oscillations=0;
        for(let i=2;i<intervals.length;i++){
          const a=intervals[i-2],b=intervals[i-1],c=intervals[i];
          if((c>b&&b<a)||(c<b&&b>a)) oscillations++;
        }
        if(oscillations>=intervals.length*0.45) reasons.push("Oscillation pattern detected");

        const spikes=intervals.filter(i=>i<30).length;
        if(spikes>3) reasons.push("Threshold spikes detected");

        const suspicionCount = reasons.length;
        const verdict = suspicionCount >= 3 ? "auto" : "legit";

        return { cps, intervals, consistency, doubleClicks, bursts, verdict, reasons };
      }

      function Sparkline({ intervals }) {
        const ref = useRef(null);
        useEffect(() => {
          const c = ref.current;
          if (!c) return;

          const ctx = c.getContext("2d");
          const w = c.width = c.offsetWidth * devicePixelRatio;
          const h = c.height = c.offsetHeight * devicePixelRatio;

          ctx.scale(devicePixelRatio, devicePixelRatio);
          ctx.clearRect(0,0,w,h);

          const data = intervals.slice(-60);
          if (!data.length) return;

          const min = Math.min(...data), max = Math.max(...data), range = Math.max(1, max-min);

          ctx.beginPath();
          data.forEach((v,i)=>{
            const x=(i/(data.length-1))*c.offsetWidth;
            const y=c.offsetHeight - ((v-min)/range)*c.offsetHeight;
            i?ctx.lineTo(x,y):ctx.moveTo(x,y);
          });

          ctx.strokeStyle="#6366f1";
          ctx.lineWidth=2;
          ctx.stroke();
        },[intervals]);

        return <canvas ref={ref} className="sparkline-canvas"/>;
      }

      function App(){
        const [step,setStep]=useState(1);
        const [length,setLength]=useState(10);
        const [running,setRunning]=useState(false);
        const [count,setCount]=useState(0);
        const [doubleCount,setDoubleCount]=useState(0);
        const [liveCPS,setLiveCPS]=useState(0);
        const [remaining,setRemaining]=useState(0);
        const [result,setResult]=useState(null);
        const [countdown,setCountdown]=useState(null);
        const [intervals,setIntervals]=useState([]);

        const timesRef=useRef([]);

        function bigStartCountdown(){
          setCountdown(3);
          let n=3;
          const timer=setInterval(()=>{
            n--;
            if(n===0){
              setCountdown("GO!");
              setTimeout(()=>{
                clearInterval(timer);
                setCountdown(null);
                start();
              },600);
            } else setCountdown(n);
          },1000);
        }

        function start(){
          timesRef.current=[];
          setRunning(true);
          setStep(3);
          setCount(0);
          setDoubleCount(0);
          setIntervals([]);

          const startT=microtime();
          const tick=setInterval(()=>{
            const elapsed=(microtime()-startT);
            setRemaining(Math.max(0,length-elapsed));
            if(elapsed>=length){
              clearInterval(tick);
              stop();
            }
          },100);
        }

        function stop(){
          setRunning(false);
          const r=analyzeClicks(timesRef.current);
          setResult({...r,clicks:timesRef.current.length});
          setStep(4);
        }

        /* ---------------------------------------
           CLICK HANDLER (REPLACED WITH CODEPEN LOGIC)
        ----------------------------------------*/
        function click(){
          if(!running) return;

          const now = microtime();  // CodePen-style timestamp
          const t = timesRef.current;

          t.push(now); 
          setCount(c => c + 1);

          if (t.length > 1) {
            const diff = now - t[t.length - 2]; // seconds

            // Fast double click threshold: 80ms (0.08s)
            if (diff <= 0.08) {
              setDoubleCount(dc => dc + 1);
            }

            // sparkline uses ms
            setIntervals(prev => [...prev.slice(-59), diff * 1000]);
          }

          // live CPS = last 1s of clicks
          const cps = t.filter(ts => ts > now - 1).length;
          setLiveCPS(cps);
        }

        return (
          <div className="min-h-screen flex flex-col items-center justify-center px-6 py-10">
            <div className="card rounded-3xl p-8 w-full max-w-3xl space-y-8">
              <h1 className="text-center text-3xl font-bold">
                <span className="text-indigo-500">Rejo</span> Autoclicker Detector
              </h1>

              {step===1&&(
                <div className="space-y-6">
                  <p>Click below to begin testing your clicks.</p>
                  <button onClick={()=>setStep(2)} className="w-full py-3 bg-indigo-600 rounded-xl hover:bg-indigo-700">Continue</button>
                </div>
              )}

              {step===2&&(
                <div className="space-y-4">
                  <label>Test length: {length}s</label>
                  <input type="range" min="5" max="20" value={length} onChange={e=>setLength(+e.target.value)} className="w-full"/>
                  <button onClick={bigStartCountdown} className="w-full py-3 bg-indigo-600 rounded-xl hover:bg-indigo-700">Start Test</button>
                </div>
              )}

              {step===3&&(
                <div className="space-y-4 text-center">
                  <div
                    onPointerDown={click}
                    className="w-full bg-red-600 text-3xl font-bold rounded-3xl py-24 select-none cursor-pointer active:scale-95 transition-transform"
                  >
                    CLICK HERE
                  </div>

                  <div className="flex justify-between text-sm opacity-80">
                    <span>Clicks: {count}</span>
                    <span>Live CPS: {liveCPS.toFixed(1)}</span>
                    <span>Double Clicks: {doubleCount}</span>
                    <span>Time: {remaining.toFixed(1)}s</span>
                  </div>

                  <Sparkline intervals={intervals}/>
                </div>
              )}

              {step===4&&result&&(
                <div className="space-y-3">
                  <h2 className="text-xl font-semibold">Results</h2>
                  <p><b>Clicks:</b> {result.clicks}</p>
                  <p><b>CPS:</b> {result.cps.toFixed(2)}</p>
                  <p><b>Consistency:</b> {result.consistency?.toFixed?.(1) || 0}%</p>
                  <p><b>Double Clicks:</b> {result.doubleClicks}</p>

                  <p><b>Verdict:</b> 
                    {result.verdict === "auto" ? (
                      <span className="text-red-500 font-semibold"> Likely Autoclicker</span>
                    ) : result.verdict === "legit" ? (
                      <span className="text-green-500 font-semibold"> Probably Legit</span>
                    ) : (
                      <span className="text-gray-400"> Insufficient Data</span>
                    )}
                  </p>

                  {result.reasons?.length>0&&(
                    <ul className="text-red-400 list-disc list-inside text-sm">
                      {result.reasons.map((r,i)=><li key={i}>{r}</li>)}
                    </ul>
                  )}

                  <Sparkline intervals={result.intervals}/>

                  <button onClick={()=>setStep(2)} className="w-full py-3 bg-indigo-600 rounded-xl hover:bg-indigo-700">Run Again</button>
                </div>
              )}
            </div>

            {countdown&&<div className="countdown-overlay">{countdown}</div>}
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
